@using Microsoft.AspNetCore.Http
@model List<GymPower.Models.Product>
@{
    ViewData["Title"] = "Начало - GymPower";
}

<!-- ⚡ Smooth Animated Hero Carousel -->
<div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="2000">
    <div class="carousel-inner">

        <!-- Slide 1 -->
        <div class="carousel-item active" style="background-image: url('/images/hero/Creatine Monohydrate Creapure (2).png');">
            <div class="overlay"></div>
            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center">
                <h1 class="fw-bold display-5 mb-2">💪 ЗАРЕДИ СИЛАТА СИ</h1>
                <p class="lead mb-3">Висококачествени добавки и аксесоари за твоята форма.</p>
                <a asp-controller="Products" asp-action="Index" class="btn btn-warning btn-sm px-4 fw-bold">ПАЗАРУВАЙ</a>
            </div>
        </div>

        <!-- Slide 2 -->
        <div class="carousel-item" style="background-image: url('/images/hero/MotivationImage.png');">
            <div class="overlay"></div>
            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center">
                <h1 class="fw-bold display-5 mb-2">🔥 ПОСТИГНИ МАКСИМАЛНА МОЩ</h1>
                <p class="lead mb-3">С протеини, BCAA и енергийни формули от GymPower.</p>
                <a href="/Products?category=Изграждане на мускулна маса" class="btn btn-warning btn-sm px-4 fw-bold">ВИЖ ПРОТЕИНИТЕ</a>
            </div>
        </div>

        <!-- Slide 3 -->
        <div class="carousel-item" style="background-image: url('/images/hero/MuscularMan.png');">
            <div class="overlay"></div>
            <div class="carousel-caption d-flex flex-column justify-content-center align-items-center">
                <h1 class="fw-bold display-5 mb-2">⚡ ВДЪХНОВИ СЕ ЗА СЛЕДВАЩАТА ТРЕНИРОВКА</h1>
                <p class="lead mb-3">Открий добавки и екипировка, създадени за успех.</p>
                <a href="/Products" class="btn btn-warning btn-sm px-4 fw-bold">РАЗГЛЕДАЙ</a>
            </div>
        </div>
    </div>
</div>

<style>
    #heroCarousel {
        height: 55vh;
        position: relative;
        overflow: hidden;
    }

    .carousel-item {
        height: 55vh;
        background-size: cover;
        background-position: center;
        transition: opacity 1s ease-in-out, transform 3s ease;
    }

        .carousel-item.active {
            animation: zoomIn 4s ease-in-out infinite alternate;
        }

    @@keyframes zoomIn {
        from {
            transform: scale(1);
        }

        to {
            transform: scale(1.05);
        }
    }

    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.55);
        z-index: 1;
    }

    .carousel-caption {
        z-index: 10;
        text-align: center;
        color: #fff;
        text-shadow: 0 2px 12px rgba(0,0,0,0.9);
    }

        .carousel-caption h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #ff6b35, #f7b733);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 4s ease-in-out infinite alternate;
        }

    @@keyframes glow {
        from {
            text-shadow: 0 0 10px rgba(255,107,53,0.4);
        }

        to {
            text-shadow: 0 0 25px rgba(255,193,7,0.9);
        }
    }

    .carousel-caption p {
        font-size: 1rem;
        color: #f1f1f1;
        margin-bottom: 10px;
    }

    .carousel-caption .btn {
        border-radius: 40px;
        padding: 8px 25px;
        font-size: 1rem;
        font-weight: 700;
        box-shadow: 0 0 15px rgba(255, 107, 53, 0.4);
        transition: all 0.3s ease;
    }

        .carousel-caption .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(255, 193, 7, 0.7);
        }
</style>


<section class="container my-5">
    <div class="text-center mb-4 text-white">
        <h2 class="fw-bold">Открийте доказани продукти според вашата цел</h2>
        <p class="lead text-secondary">Стремите се към:</p>
    </div>

    <div class="row g-4 justify-content-center">
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Отслабване" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                🔥 Отслабване
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Изграждане на мускулна маса" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                💪 Изграждане на мускулна маса
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Регенерация" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                ♻️ Подпомагане на регенерацията
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Висока производителност" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                ⚡ Висока производителност
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Имунитет" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                🛡️ Повишаване на имунитета
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Здравословна закуска" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                🍎 Здравословна междинна закуска
            </a>
        </div>
        <div class="col-md-3">
            <a href="@Url.Action("Index", "Products", new { category = "Облекло" })" class="btn btn-outline-warning w-100 py-3 fw-semibold">
                👕 Спортно облекло
            </a>
        </div>
    </div>
</section>

<style>
    .category-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .category-card:hover {
            background-color: rgba(255, 193, 7, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }
</style>


<!-- Features Section -->
<div class="container mt-5">
    <div class="row g-4 text-white text-center">
        <div class="col-md-4">
            <div class="feature-card p-4 rounded bg-dark shadow floating">
                <i class="fas fa-shipping-fast fa-2x text-warning mb-3"></i>
                <h5>Бърза и безплатна доставка</h5>
                <p>Безплатна доставка при поръчки над 50 лв. Получи продуктите си в рамките на 2–3 дни.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card p-4 rounded bg-dark shadow floating" style="animation-delay: 0.2s;">
                <i class="fas fa-award fa-2x text-warning mb-3"></i>
                <h5>Премиум качество</h5>
                <p>Независимо тествани добавки с доказани резултати и гарантирана чистота.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="feature-card p-4 rounded bg-dark shadow floating" style="animation-delay: 0.4s;">
                <i class="fas fa-headset fa-2x text-warning mb-3"></i>
                <h5>Експертна поддръжка</h5>
                <p>Денонощно обслужване и персонални фитнес съвети от нашите специалисти.</p>
            </div>
        </div>
    </div>
</div>

<!-- Featured Products -->
<div class="container mt-5">
    <div class="text-center mb-4 text-white">
        <h2 class="fw-bold">ПРЕПОРЪЧАНИ ПРОДУКТИ</h2>
        <p class="lead text-secondary">Най-продаваните добавки за спортисти и активни хора</p>
    </div>

    <div class="row g-4">
        @foreach (var product in Model)
        {
            <div class="col-xl-4 col-lg-6 col-md-6">
                <div class="card h-100 shadow bg-dark text-white border-0">
                    <div class="position-relative overflow-hidden">
                        <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name"
                             onerror="this.src='/images/default-product.jpg'"
                             style="height: 250px; object-fit: cover;">
                        <span class="badge bg-warning text-dark position-absolute top-0 end-0 m-3">
                            <i class="fas fa-star me-1"></i> Препоръчан
                        </span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold text-warning">@product.Name</h5>
                        <p class="card-text text-white flex-grow-1">@product.Description</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-light text-dark">@product.Category</span>
                            <span class="text-warning fw-bold">Наличност: @product.StockQuantity</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="fw-bold text-warning mb-0">@product.Price.ToString("F2") лв.</h4>
                            @if (Context.Session.GetString("Role") == "Admin")
                            {
                                <div>
                                    <a asp-controller="Products" asp-action="Edit" asp-route-id="@product.Id"
                                       class="btn btn-warning btn-sm"><i class="fas fa-edit"></i></a>
                                    <a asp-controller="Products" asp-action="Delete" asp-route-id="@product.Id"
                                       class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></a>
                                </div>
                            }
                            else
                            {
                                <a href="@Url.Action("AddToCart", "Cart", new { id = product.Id })"
                                   class="btn btn-warning text-dark fw-bold add-to-cart-link">
                                    <i class="fas fa-cart-plus me-2"></i> ДОБАВИ В КОЛИЧКАТА
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="text-center mt-5">
        <a asp-controller="Products" asp-action="Index" class="btn btn-outline-warning btn-lg px-5">
            <i class="fas fa-store me-2"></i> ВИЖ ВСИЧКИ ПРОДУКТИ
        </a>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("click", async (e) => {
            const link = e.target.closest(".add-to-cart-link");
            if (!link) return;

            e.preventDefault();
            const url = link.getAttribute("href");

            try {
                const response = await fetch(url, {
                    method: "GET",
                    credentials: "same-origin",
                    redirect: "follow"
                });

                if (response.status >= 200 && response.status < 400) {
                    showToast("✅ Продуктът беше добавен в количката!");
                    bumpCartBadge();
                } else {
                    showToast("⚠️ Неуспешно добавяне на продукта.", true);
                }
            } catch {
                showToast("⚠️ Сървърна грешка. Опитайте отново по-късно.", true);
            }
        });

        function showToast(message, isError = false) {
            const toast = document.createElement("div");
            toast.textContent = message;
            Object.assign(toast.style, {
                position: "fixed",
                bottom: "30px",
                right: "30px",
                background: isError ? "#dc3545" : "#28a745",
                color: "#fff",
                padding: "12px 20px",
                borderRadius: "8px",
                boxShadow: "0 2px 10px rgba(0,0,0,0.2)",
                zIndex: "9999",
                fontWeight: "600",
                transition: "opacity 0.3s ease"
            });
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = "0";
                setTimeout(() => toast.remove(), 500);
            }, 2000);
        }

        function bumpCartBadge() {
            const badge = document.querySelector("#cartCountBadge");
            if (!badge) return;
            const n = parseInt(badge.textContent || "0", 10);
            badge.textContent = (n + 1).toString();
            badge.style.display = "inline-block";
        }
    </script>
}
